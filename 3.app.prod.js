(window.webpackJsonp=window.webpackJsonp||[]).push([[3],{442:function(e,t,r){"use strict";r.r(t);var i=r(155);var o=function(e){if(!Array.isArray(e))throw new TypeError("Middleware stack must be an array!");for(const t of e)if("function"!=typeof t.match||"function"!=typeof t.resolve)throw new TypeError("Middleware must be composed of functions!");return function(t){let r=-1;return function i(o){if(o<=r)return Promise.reject(new Error("next() called multiple times"));r=o;let a=e[o];if(!a)return Promise.resolve();if(!a.match(t.req.url,t))return Promise.resolve(i(o+1));try{return Promise.resolve(a.resolve(t,function(){return i(o+1)}))}catch(e){return Promise.reject(e)}}(0)}};var a={match:({origin:e})=>e===location.origin,resolve(e,t){throw new Error("Unable to request Metastream app link")}},l=r(545),n=r(43),s=r(62);const p=new Set(["user-agent","referer"]),d=e=>("object"==typeof e&&(e={...e},Object.keys(e).forEach(t=>{p.has(t.toLowerCase())&&(e[`X-Metastream-${t}`]=e[t])})),e);let m=0;const c=(e,t={})=>new Promise((r,i)=>{e.startsWith("//")&&(e=`https:${e}`);try{new URL(e)}catch(e){return void i(e)}t={credentials:"omit",...t,headers:d(t.headers)};const o=m++,a=e=>{const{data:t}=e;if("object"!=typeof t)return;if(t.type!==`metastream-fetch-response${o}`)return;window.removeEventListener("message",a,!1);const{err:l,resp:n}=t.payload;l?i(l):r(n)};window.addEventListener("message",a,!1),Object(s.a)("metastream-fetch",{requestId:o,url:e,options:t})}),u=async(e,t)=>{const r=await c(e,t);return[r.body,r]};var g=r(97);const h=/reddit\.com\/r\/([^\s/]+)\/?/i,f=({data:e})=>{let t={id:e.id,url:e.url,title:`${e.title} - /r/${e.subreddit}`};const r=e.crosspost_parent_list;if(e.media&&(t.media=e.media),r&&r.length>0){const e=r[0];e.url&&(t.url=e.url),e.media&&(t.media=e.media)}return t},y=async(e,t)=>{const r=Object(l.parse)(e,!0),i={...r.query,limit:5};t&&(i.after=t);const o=Object(n.a)(i),a=`${r.protocol}//${r.hostname}${r.pathname}.json?${o}`,[s]=await u(a,{headers:{Referer:g.c}});return s},w=e=>{return e.data.children.filter(e=>!e.data.stickied).map(f)};var b={match(e,t){const r=!!h.exec(e.href),i=!!e.pathname&&e.pathname.includes("/comments/");return r&&!i||!(!t.req.state||!t.req.state.reddit)},async resolve(e,t){const r=e.req.state;let i,o,a,l;if(r&&r.reddit)i=r.reddit.href,o=r.reddit.children,a=r.reddit.after,l=r.reddit.idx;else{i=e.req.url.href;const r=await y(i);if(console.log("Subreddit JSON",r),r.error)return console.debug("Error fetching subreddit posts"),t();const n=w(r);if(0===n.length)return t();o=n,a=r.data.after,l=-1}let n=l+1,s=o[n];if(!s){const e=await y(r.reddit.href,r.reddit.after),i=w(e);if(0===i.length)return t();if(s=(o=i)[n=0],a=e.data.after,!s)return}if(e.res.type="playlist",e.res.hasMore=!0,e.res.state={...e.res.state,reddit:{...(r||{}).reddit,href:i,idx:n,children:o,after:a}},!((e,t)=>{e.res.title=t.title;const r=new URL(t.url);r&&r.href&&(e.req.url=r);const{media:i}=t;if(i){if(i.reddit_video){const t=i.reddit_video;r&&r.href&&(e.res.url=r.href);const o=1e3*t.duration;return o&&(e.res.duration=o),!0}if(i.oembed)return!1}return!1})(e,s)){await t();let r=s.title||e.res.title;return e.res.title=r,e.res}}},I=r(98);const v=/youtu\.?be(?:.com)?/i,N=[/youtu\.be\/([^#\&\?]{11})/,/\?v=([^#\&\?]{11})/,/\&v=([^#\&\?]{11})/,/embed\/([^#\&\?]{11})/,/\/v\/([^#\&\?]{11})/];class P{static getInstance(){return this.instance||(this.instance=new P),this.instance}getVideoId(e){let t;for(let r=0;r<N.length&&!(t=N[r].exec(e));r++);return t?t[1]:null}}var V={match(e){const{hostname:t="",href:r=""}=e;return!!v.exec(t)&&!!P.getInstance().getVideoId(r)},async resolve(e,t){let r;try{r=await async function(e,t){const r=t("meta[itemprop=duration]").attr("content"),i=t("meta[itemprop=isLiveBroadcast]"),o=t("meta[itemprop=endDate]");let a;a="true"!==(i.attr("content")||"").toLowerCase()||o?r?1e3*Object(I.f)(r):void 0:0;const l=t("#eow-description"),n=1===l.length?Object(I.e)(l):void 0;return e.searchParams.has("t"),{duration:a,description:n}}(e.req.url,e.state.$)}catch(e){return console.error("YouTube request failed",e.message),t()}return Object(I.b)(e.res,r),e.res.state.referrer=!0,e.state.oEmbed=!1,t()}};const j=/youtu\.?be(?:.com)?/i;var x={match(e,t){const r=!!j.exec(e.href),i=e.searchParams.has("list");return r&&i||Boolean(t.req.state&&t.req.state.ytpl)},async resolve(e,t){const{state:r}=e.req,i=r&&r.ytpl||{};if(void 0===i.index){await t();const{res:r}=e,{body:o,$:a}=e.state;if(!o||!a)return;const l=a(".playlist-title").text()||r.title;i.title=(l||"YouTube Playlist").trim();const n=a("#playlist-length").text().split(" ")[0],s=parseInt(n,10);if(isNaN(s)){try{const t=new URL(e.res.url);t.searchParams.delete("list"),e.res.url=t.href}catch{}return e.res}i.length=s;const p=a("li.currently-playing").data("index"),d=e.req.url.searchParams,m=p||d.get("index")||"0";i.index=parseInt(m,10)||0,e.res.state.ytpl=i}else{i.index++;const t=e.req.url;t.pathname="/embed/videoseries",t.searchParams.set("index",`${i.index}`),e.res.url=t.toString()}let{index:o,length:a,title:l}=i;return e.res.title=l,e.res.state={...e.req.state,ytpl:i,referrer:!0},e.res.hasMore=o<a-1,e.res}};var O={match:({protocol:e})=>"http:"===e||"https:"===e,async resolve(e,t){const{url:r}=e.req;let i;try{i=await(async(e,t)=>{return await c(e,t)})(r.href,{method:"HEAD",headers:{"user-agent":g.e,referer:r.href}})}catch{return e.state.httpHeadFailed=!0,t()}const o=i.status||200,a=i.headers.server,l=(e=>(e=(e=Array.isArray(e)?e[0]:e)&&e.split(";").shift()||"").trim())(i.headers["content-type"]),n=(e=>e?(e.split("/").shift()||"").toLowerCase():"")(l);return e.state.responseCode=o,e.state.contentType=l,e.state.type=n,e.state.disableGooglebot="cloudflare"===a,t()}},W=r(106);const q=new Set(["audio","image","video"]);var A={match:({protocol:e})=>"http:"===e||"https:"===e,resolve({req:e,res:t,state:r},i){const{url:o}=e,{type:a}=r;if(a&&q.has(a)){const e=function(e){return{url:e.href,title:Object(W.basename)(e.pathname||e.href)}}(o);return t.url=e.url||t.url,t.title=t.title||e.title,t}return i()}},S=r(493);const H=(e,t)=>{const r=e.attribs.href.includes(".ico"),i=t.attribs.href.includes(".ico");return r&&!i?1:!r&&i?-1:0};var L={match:({protocol:e})=>"http:"===e||"https:"===e,async resolve(e,t){const{url:r}=e.req;if(e.state.httpHeadFailed)return t();let i;try{i=(await u(r.href,{headers:e.state.disableGooglebot?{}:{"user-agent":g.e,host:r.host}}))[0]}catch{return t()}e.state.body=i;const o=e.state.$=Object(S.load)(i);try{e.res.title=(e=>e("title").text().trim())(o)||e.res.title,e.res.favicon=((e,t)=>{const r=Array.from(t("head link")).filter(e=>!!new Set((e.attribs.rel||"").split(" ")).has("icon"));if(0===r.length)return;r.sort(H);const i=r[0];let o;try{o=new URL(i.attribs.href).href}catch{}if(!o)try{o=new URL(`${e.req.url.origin}${i.attribs.href}`).href}catch{}return o})(e,o)}catch(e){console.error(e)}return t()}},T=r(787);const $=[{multiple:!1,property:"og:title",fieldName:"ogTitle"},{multiple:!1,property:"og:type",fieldName:"ogType"},{multiple:!0,property:"og:image",fieldName:"ogImage"},{multiple:!0,property:"og:image:url",fieldName:"ogImageURL"},{multiple:!0,property:"og:image:secure_url",fieldName:"ogImageSecureURL"},{multiple:!0,property:"og:image:width",fieldName:"ogImageWidth"},{multiple:!0,property:"og:image:height",fieldName:"ogImageHeight"},{multiple:!0,property:"og:image:type",fieldName:"ogImageType"},{multiple:!1,property:"og:url",fieldName:"ogUrl"},{multiple:!1,property:"og:audio",fieldName:"ogAudio"},{multiple:!1,property:"og:audio:url",fieldName:"ogAudioURL"},{multiple:!1,property:"og:audio:secure_url",fieldName:"ogAudioSecureURL"},{multiple:!1,property:"og:audio:type",fieldName:"ogAudioType"},{multiple:!1,property:"og:description",fieldName:"ogDescription"},{multiple:!1,property:"og:determiner",fieldName:"ogDeterminer"},{multiple:!1,property:"og:locale",fieldName:"ogLocale"},{multiple:!1,property:"og:locale:alternate",fieldName:"ogLocaleAlternate"},{multiple:!1,property:"og:site_name",fieldName:"ogSiteName"},{multiple:!0,property:"og:video",fieldName:"ogVideo"},{multiple:!0,property:"og:video:url",fieldName:"ogVideo"},{multiple:!0,property:"og:video:secure_url",fieldName:"ogVideoSecureURL"},{multiple:!0,property:"og:video:width",fieldName:"ogVideoWidth"},{multiple:!0,property:"og:video:height",fieldName:"ogVideoHeight"},{multiple:!0,property:"og:video:type",fieldName:"ogVideoType"},{multiple:!0,property:"og:video:duration",fieldName:"ogVideoDuration"},{multiple:!0,property:"video:duration",fieldName:"videoDuration"},{multiple:!1,property:"twitter:card",fieldName:"twitterCard"},{multiple:!1,property:"twitter:site",fieldName:"twitterSite"},{multiple:!1,property:"twitter:site:id",fieldName:"twitterSiteId"},{multiple:!1,property:"twitter:creator",fieldName:"twitterCreator"},{multiple:!1,property:"twitter:creator:id",fieldName:"twitterCreatorId"},{multiple:!1,property:"twitter:title",fieldName:"twitterTitle"},{multiple:!1,property:"twitter:description",fieldName:"twitterDescription"},{multiple:!0,property:"twitter:image",fieldName:"twitterImage"},{multiple:!0,property:"twitter:image:height",fieldName:"twitterImageHeight"},{multiple:!0,property:"twitter:image:width",fieldName:"twitterImageWidth"},{multiple:!0,property:"twitter:image:src",fieldName:"twitterImageSrc"},{multiple:!0,property:"twitter:image:alt",fieldName:"twitterImageAlt"},{multiple:!0,property:"twitter:player",fieldName:"twitterPlayer"},{multiple:!0,property:"twitter:player:width",fieldName:"twitterPlayerWidth"},{multiple:!0,property:"twitter:player:height",fieldName:"twitterPlayerHeight"},{multiple:!0,property:"twitter:player:stream",fieldName:"twitterPlayerStream"},{multiple:!1,property:"twitter:app:name:iphone",fieldName:"twitterAppNameiPhone"},{multiple:!1,property:"twitter:app:id:iphone",fieldName:"twitterAppIdiPhone"},{multiple:!1,property:"twitter:app:url:iphone",fieldName:"twitterAppUrliPhone"},{multiple:!1,property:"twitter:app:name:ipad",fieldName:"twitterAppNameiPad"},{multiple:!1,property:"twitter:app:id:ipad",fieldName:"twitterAppIdiPad"},{multiple:!1,property:"twitter:app:url:ipad",fieldName:"twitterAppUrliPad"},{multiple:!1,property:"twitter:app:name:googleplay",fieldName:"twitterAppNameGooglePlay"},{multiple:!1,property:"twitter:app:id:googleplay",fieldName:"twitterAppIdGooglePlay"},{multiple:!1,property:"twitter:app:url:googleplay",fieldName:"twitterAppUrlGooglePlay"}];var U=function(e){return{url:e[0],width:e[1],height:e[2],alt:e[3]}},R=function(e){return{url:e[0],width:e[1],height:e[2],stream:e[3]}},E=function(e){return{url:e[0],width:e[1],height:e[2],type:e[3],duration:(t=e[4],isNaN(t)||(t=t%1==0?parseInt(t,10):parseFloat(t)),t)};var t},D=function(e,t){if(!e.url||!t.url)return 0;var r=e.url.match(/\.(\w{2,5})$/),i=r&&r[1].toLowerCase()||null,o=t.url.match(/\.(\w{2,5})$/),a=o&&o[1].toLowerCase()||null;return"gif"===i&&"gif"!==a?-1:"gif"!==i&&"gif"===a?1:Math.max(t.width,t.height)-Math.max(e.width,e.height)};const M=new Set(["application/x-shockwave-flash"]),k=new Set(["www.netflix.com"]);function _(e,t){const r=function(e,t){const r=void 0===t.ogImageFallback||t.ogImageFallback;let i=Object(S.load)(e),o=i("meta"),a=Object.keys(o),l={};a.forEach(function(e){if(o[e].attribs&&(o[e].attribs.property||o[e].attribs.name)){var t=o[e].attribs.property||o[e].attribs.name,r=o[e].attribs.content;$.forEach(function(e){t===e.property&&(e.multiple?l[e.fieldName]?Array.isArray(l[e.fieldName])&&l[e.fieldName].push(r):l[e.fieldName]=[r]:l[e.fieldName]=r)})}}),l.ogImage=l.ogImageSecureURL?l.ogImageSecureURL:l.ogImage?l.ogImage:l.ogImageURL?l.ogImageURL:[],l.ogImage&&l.ogImage.length||delete l.ogImage,(l.ogImage||l.ogImageWidth||l.twitterImageHeight||l.ogImageType)&&(l.ogImage=l.ogImage?l.ogImage:[null],l.ogImageWidth=l.ogImageWidth?l.ogImageWidth:[null],l.ogImageHeight=l.ogImageHeight?l.ogImageHeight:[null],l.ogImageType=l.ogImageType?l.ogImageType:[null]);var n=Object(T.a)(l.ogImage,l.ogImageWidth,l.ogImageHeight,l.ogImageType).map(E).sort(D);(l.ogVideo||l.ogVideoWidth||l.ogVideoHeight||l.ogVideoType||l.ogVideoDuration)&&(l.ogVideo=l.ogVideo?l.ogVideo:[null],l.ogVideo=l.ogVideoSecureURL?l.ogVideoSecureURL:l.ogVideo,l.ogVideoWidth=l.ogVideoWidth?l.ogVideoWidth:[null],l.ogVideoHeight=l.ogVideoHeight?l.ogVideoHeight:[null],l.ogVideoType=l.ogVideoType?l.ogVideoType:[null],l.ogVideoDuration=l.videoDuration||l.ogVideoDuration||[null]);var s=Object(T.a)(l.ogVideo,l.ogVideoWidth,l.ogVideoHeight,l.ogVideoType,l.ogVideoDuration).map(E).sort(D);(l.twitterImageSrc||l.twitterImage||l.twitterImageWidth||l.twitterImageHeight||l.twitterImageAlt)&&(l.twitterImage=l.twitterImage?l.twitterImage:l.twitterImageSrc,l.twitterImage=l.twitterImage?l.twitterImage:[null],l.twitterImageWidth=l.twitterImageWidth?l.twitterImageWidth:[null],l.twitterImageHeight=l.twitterImageHeight?l.twitterImageHeight:[null],l.twitterImageAlt=l.twitterImageAlt?l.twitterImageAlt:[null]);var p=Object(T.a)(l.twitterImage,l.twitterImageWidth,l.twitterImageHeight,l.twitterImageAlt).map(U).sort(D);(l.twitterPlayer||l.twitterPlayerWidth||l.twitterPlayerHeight||l.twitterPlayerStream)&&(l.twitterPlayer=l.twitterPlayer?l.twitterPlayer:[null],l.twitterPlayerWidth=l.twitterPlayerWidth?l.twitterPlayerWidth:[null],l.twitterPlayerHeight=l.twitterPlayerHeight?l.twitterPlayerHeight:[null],l.twitterPlayerStream=l.twitterPlayerStream?l.twitterPlayerStream:[null]);var d=Object(T.a)(l.twitterPlayer,l.twitterPlayerWidth,l.twitterPlayerHeight,l.twitterPlayerStream).map(R).sort(D);if($.filter(function(e){return e.multiple}).forEach(function(e){delete l[e.fieldName]}),n.length&&(t.allMedia?l.ogImage=n:l.ogImage=n[0]),s.length&&(t.allMedia?l.ogVideo=s:l.ogVideo=s[0]),p.length&&(t.allMedia?l.twitterImage=p:l.twitterImage=p[0]),d.length&&(t.allMedia?l.twitterPlayer=d:l.twitterPlayer=d[0]),!t.onlyGetOpenGraphInfo&&(!l.ogTitle&&i("head > title").text()&&i("head > title").text().length>0&&(l.ogTitle=i("head > title").text()),!l.ogDescription&&i('head > meta[name="description"]').attr("content")&&i('head > meta[name="description"]').attr("content").length>0&&(l.ogDescription=i('head > meta[name="description"]').attr("content")),!l.ogImage&&r)){var m=["jpg","jpeg","png"];i("img").each(function(e,t){if(i(t).attr("src")&&i(t).attr("src").length>0&&-1!==m.indexOf(i(t).attr("src").split(".").pop()))return l.ogImage={url:i(t).attr("src")},!1})}return l}(t,{});console.log("og",r);const{ogTitle:i,ogImage:o,ogDescription:a}=r,l=o?{0:o.url}:void 0,s={url:e.href,title:i,thumbnails:l,description:a};let p=!k.has(e.hostname);if(p&&r.ogVideo){const e=r.ogVideo.type,t=r.ogVideo.url;(p=(!e||!M.has(e))&&t&&Object(n.c)(t))&&(s.url=t),r.ogVideo.duration&&(s.duration=1e3*r.ogVideo.duration)}return s}var C={match:({protocol:e})=>"http:"===e||"https:"===e,async resolve(e,t){const{url:r}=e.req,{$:i,body:o}=e.state;if(i&&o){const t=_(r,o);Object(I.b)(e.res,t)}return t()}};const G=/\/wp-json\/oembed\/.*?\/embed/i;var F={match:({protocol:e})=>"http:"===e||"https:"===e,async resolve(e,t){if("boolean"==typeof e.state.oEmbed&&!e.state.oEmbed)return t();const{url:r}=e.req;let i;if(e.state.oEmbedJson)i=e.state.oEmbedJson;else if(e.state.$){const{$:t}=e.state,r=t("link[type='text/json+oembed'], link[type='application/json+oembed']").attr("href");r&&!G.test(r)&&(i=await async function(e){const[t]=await u(e,{headers:{"user-agent":g.e}});return t}(r))}if(i){console.info("oembed",i);const t={url:function(e){if("string"==typeof e.html){const t=e.html.startsWith("&lt;")?Object(S.load)(e.html)("body").text():e.html;let r=Object(S.load)(t)("iframe").attr("src");if(r)return r.startsWith("//")?`https:${r}`:r}}(i),description:i.description};Object(I.b)(e.res,t)}return t()}};const J=(e,t)=>{if(t[e])return t[e]="true",!0};var B={match:({protocol:e,host:t})=>!(t&&t.indexOf("redd.it")>-1)&&("http:"===e||"https:"===e),async resolve(e,t){const{url:r}=e.res;return!!r&&r.endsWith("mp4")||(e.res.url=(e=>{const t=Object(l.parse)(e,!0),{query:r}=t;return J("autoplay",r)||J("auto_play",r)||["autoplay","auto_play"].forEach(e=>{r[e]="true"}),t.search=Object(n.a)(r),Object(l.format)(t)})(r)),t()}},Y=r(783);var X={match:({protocol:e})=>"http:"===e||"https:"===e,async resolve(e,t){const{url:r}=e.req,{$:i}=e.state;if(i){i("noscript").each(function(t,r){const i=e.state.$(r).text();if(-1===i.indexOf("schema.org"))return;const o=Object(S.load)(i)("meta[itemprop='duration']").attr("content");if(o){const t=1e3*Object(Y.toSeconds)(Object(Y.parse)(o));t&&!isNaN(t)&&(e.res.duration=t)}})}return t()}};var z={match(e){const{hostname:t=""}=e;return t.endsWith("imgur.com")},async resolve(e,t){const{$:r}=e.state;if(r){const i=r("title").text().trim(),o=r("link[rel=image_src]").attr("href");if(!i.endsWith("Album on Imgur")&&o)return await t(),e.res.url=o,e.res}return t()}};class K extends Error{constructor(e){super(`Media Request Error (${e})`),this.code=e,Object.setPrototypeOf(this,K.prototype)}}new Set(["image/gif","text/html","image/jpeg","audio/mpeg","video/mpeg","audio/ogg","video/ogg","application/ogg","audio/opus","image/svg+xml","text/plain","audio/wav","audio/webm","video/webm","image/webp","application/xhtml+xml"]);var Q={match:({protocol:e})=>"http:"===e||"https:"===e,async resolve(e,t){const{contentType:r,headResponseHeaders:i}=e.state;if(i){const e=i["content-disposition"];if("string"==typeof e&&e.startsWith("attachment"))throw new K(3)}return t()}};r.d(t,"resolveMediaUrl",function(){return re}),r.d(t,"resolveMediaPlaylist",function(){return ie});const Z=[a,b,x,O,Q,A,L,V,z,C,F,X,B],ee=e=>{return{req:{type:"item",url:e,user:null},res:{type:"item",url:e.href,state:{}},state:{}}},te=e=>{if(e.description){const t=e.description.trim();e.description=t||void 0}return Object(i.a)(e)},re=async e=>{const t=new URL(e);if(!t.href)return null;const r=ee(t),i=o(Z),a=await i(r)||r.res;return console.debug("Resolved media",r),te(a)},ie=async e=>{const t=new URL(e.url);if(!t.href)return null;const r=ee(t);r.req={...r.req,type:e.type,state:e.state},console.log("resolving playlist",r);const i=o(Z),a=await i(r)||r.res;return te(a)}},621:function(e,t){}}]);
//# sourceMappingURL=3.app.prod.js.map